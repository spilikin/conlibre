= Con Libre: simple API simulator for gematik Konnektor
ifdef::env-github[]
:imagesdir:https://raw.githubusercontent.com/spilikin/telematik-konemu/master/
endif::[]
ifndef::env-github[]
:imagesdir: ./
endif::[]


image:mask.png[width=20%]

== Usage

----
gradle clean 
gradle bootRun
----

== Access ServiceDirectory

=== Request
[cols="h,m"] 
|===
|URI        |http://localhost:8080/connector.sds
|Method     |GET
|CURL       |curl -i http://localhost:8080/connector.sds
|===

=== Response
[source,xml]
----
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns2:ConnectorServices xmlns="http://ws.gematik.de/int/version/ProductInformation/v1.1" xmlns:ns2="http://ws.gematik.de/conn/ServiceDirectory/v3.1" xmlns:ns3="http://ws.gematik.de/conn/ServiceInformation/v2.0">
  <ns2:TLSMandatory>false</ns2:TLSMandatory>
  <ns2:ClientAutMandatory>false</ns2:ClientAutMandatory>
  <ns3:ServiceInformation>
    <ns3:Service Name="AuthSignatureService">
      <ns3:Versions>
        <ns3:Version TargetNamespace="http://ws.gematik.de/conn/AuthSignatureService/WSDL/v7.4" Version="7.4.0">
          <ns3:Endpoint Location="http://localhost:8080/soap-api/AuthSignatureService/7.4.0"/> <1>
        </ns3:Version>
      </ns3:Versions>
    </ns3:Service>
    <ns3:Service Name="EventService">
      <ns3:Versions>
        <ns3:Version TargetNamespace="http://ws.gematik.de/conn/EventService/WSDL/v7.2" Version="7.2.0">
          <ns3:Endpoint Location="http://localhost:8080/soap-api/EventService/7.2.0"/>
        </ns3:Version>
      </ns3:Versions>
    </ns3:Service>
    <ns3:Service Name="CardService">
      <ns3:Versions>
        <ns3:Version TargetNamespace="http://ws.gematik.de/conn/CardService/WSDL/v8.1" Version="8.1.1">
          <ns3:Endpoint Location="http://localhost:8080/soap-api/CardService/8.1.1"/>
        </ns3:Version>
      </ns3:Versions>
    </ns3:Service>
    <ns3:Service Name="CardService">
      <ns3:Versions>
        <ns3:Version TargetNamespace="http://ws.gematik.de/conn/CardService/WSDL/v8.1" Version="8.1.2">
          <ns3:Endpoint Location="http://localhost:8080/soap-api/CardService/8.1.2"/>
        </ns3:Version>
      </ns3:Versions>
    </ns3:Service>
  </ns3:ServiceInformation>
</ns2:ConnectorServices>
----

== Get all available Smartcards

=== Request

[cols="h,m"] 
|===
|URI        |http://localhost:8080/soap-api/EventService/7.2.0
|Method     |POST
|HTTP Header `SOAPAction` |http://ws.gematik.de/conn/EventService/v7.2#GetCards
|CURL       | smth
|===

==== Payload
[source,xml]
----
<soap-env:Envelope xmlns:soap-env="http://schemas.xmlsoap.org/soap/envelope/">
  <soap-env:Body>
    <ns0:GetCards xmlns:ns0="http://ws.gematik.de/conn/EventService/v7.2" mandant-wide="false">
      <ns1:Context xmlns:ns1="http://ws.gematik.de/conn/ConnectorContext/v2.0">
        <ns2:MandantId xmlns:ns2="http://ws.gematik.de/conn/ConnectorCommon/v5.0">unknown MandantId</ns2:MandantId>
        <ns3:ClientSystemId xmlns:ns3="http://ws.gematik.de/conn/ConnectorCommon/v5.0">unknown ClientSystemId</ns3:ClientSystemId>
        <ns4:WorkplaceId xmlns:ns4="http://ws.gematik.de/conn/ConnectorCommon/v5.0">unknown WorkplaceId</ns4:WorkplaceId>
      </ns1:Context>
    </ns0:GetCards>
  </soap-env:Body>
</soap-env:Envelope>
----

=== Response
[source,xml]
---
---

== Development

=== Toolchain installation

1. (optional) Install SDKMAN from http://sdkman.io
2. Install Java 11 and Gradle
----
sdk install java
sdk install gradle
----

.Generate RSA self signed certificates
----
openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 1825
openssl pkcs8 -topk8 -inform PEM -in key.pem -out privatekey.pem -nocrypt
----

.TODO: Generate ECC self signed certificates
----
openssl ...
----

